---
name: 'step-05-domain'
description: '探索针对复杂领域的具体领域需求（可选步骤）'

# File References
nextStepFile: './step-06-innovation.md'
outputFile: '{planning_artifacts}/prd.md'
domainComplexityCSV: '../data/domain-complexity.csv'

# Task References
advancedElicitationTask: 'references/advanced-elicitation.workflow.xml'
partyModeWorkflow: 'references/party-mode.workflow.md'
---

# 步骤 5: 领域特定需求 (可选)

**进度：第 5 步，共 13 步** - 下一步：创新重点

## 步骤目标：

仅针对在 {domainComplexityCSV} 中有映射的复杂领域，探索塑造产品的领域特定约束、合规性要求和技术考虑因素。

## 强制执行规则 (请先阅读):

### 通用规则：

- 🛑 绝不 在没有用户输入的情况下生成内容
- 📖 关键：在采取任何行动之前，请阅读完整的步骤文件
- 🔄 关键：当使用 'C' 加载下一步时，确保已阅读整个文件
- ✅ 始终 将此视为 PM 同伴之间的协作发现
- 📋 你是一个协调员，而不是内容生成器
- ✅ 你必须始终使用配置的 `{communication_language}` 以你的 Agent 沟通风格输出语言

### 角色强化：

- ✅ 你是一个专注于产品的 PM 协调员，与专家同伴合作
- ✅ 我们参与协作对话，而不是命令-响应
- ✅ 你带来结构化思维和协调技巧，而用户带来领域专业知识

### 步骤特定规则：

- 🎯 此步骤是 **可选的** - 仅复杂领域需要
- 🚫 如果来自 step-02 的领域复杂性为 "low" (低)，则 **跳过**
- 💬 方法：自然对话以发现领域特定需求
- 🎯 重点关注约束、合规性和领域模式

## 执行协议：

- 🎯 首先从 step-02 分类中检查领域复杂性
- ⚠️ 如果复杂性为 "low"，提议跳过此步骤
- ⚠️ 在定义领域需求（或跳过）后展示 A/P/C 菜单
- 💾 仅 当用户选择 C (继续) 时保存
- 📖 更新输出文件 frontmatter，将此步骤名称添加到 stepsCompleted 列表的末尾
- 🚫 禁止 在选择 C 之前加载下一步

## 上下文边界：

- 来自 step-02 的领域分类可用
- 如果复杂性低，可以跳过此步骤
- 领域 CSV 数据提供复杂性参考
- 专注于领域特定的约束，而不是一般需求

## 你的任务：

对于复杂领域，探索使该领域特殊的因素：
- **合规性要求** - 法规、标准、认证
- **技术约束** - 安全性、隐私、集成要求
- **领域模式** - 常见模式、最佳实践、反模式
- **风险与缓解** - 可能出什么错，如何预防

## 领域发现序列：

### 1. 检查领域复杂性

**审查来自 step-02 的分类：**

- 领域复杂性水平如何？(low/medium/high)
- 具体领域是什么？（医疗保健、金融科技、教育等）

**如果复杂性为 LOW (低)：**

提议跳过：
"根据我们的发现，领域复杂性较低。我们可能不需要深入的领域特定需求。你想：
- [C] 跳过此步骤并移动到创新
- [D] 无论如何都要进行领域探索"

**如果复杂性为 MEDIUM (中) 或 HIGH (高)：**

继续进行领域探索。

### 2. 加载领域参考数据

**尝试子流程数据查找：**

"你的任务：在 {domainComplexityCSV} 中查找数据

**搜索标准：**
- 查找 domain 匹配 {{domainFromStep02}} 的行

**返回格式：**
仅返回匹配的行作为 YAML 格式的对象，包含以下字段：
domain, complexity, typical_concerns, compliance_requirements

**不要返回整个 CSV - 仅返回匹配的行。**"

**优雅降级（如果任务工具不可用）：**
- 直接加载 CSV 文件
- 手动查找匹配的行
- 提取所需字段
- 了解典型的关注点和合规性要求

### 3. 探索领域特定关注点

**从你知道的开始：**

确认该领域并探索使其复杂的因素：
- 适用哪些法规？（HIPAA, PCI-DSS, GDPR, SOX 等）
- 哪些标准很重要？（ISO, NIST, 领域特定标准）
- 需要哪些认证？（安全性、隐私、领域特定）
- 需要哪些集成？（EMR 系统、支付处理器等）

**探索技术约束：**
- 安全要求（加密、审计日志、访问控制）
- 隐私要求（数据处理、同意、保留）
- 性能要求（实时、批处理、延迟）
- 可用性要求（正常运行时间、灾难恢复）

### 4. 记录领域需求

**围绕关键关注点构建需求：**

```markdown
### 合规性与监管
- [具体要求]

### 技术约束
- [安全性、隐私、性能需求]

### 集成要求
- [所需系统和数据流]

### 风险缓解
- [领域特定风险以及如何解决它们]
```

### 5. 验证完整性

**与用户检查：**

"除了这些，我们还需要考虑其他领域特定的关注点吗？对于 [此领域]，通常有什么被忽视的吗？"

### N. 展示菜单选项

显示： "**选择：** [A] 高级诱导 [P] 派对模式 [C] 继续 - 保存并进行到创新 (第 6 步，共 13 步)"

#### 菜单处理逻辑：
- 如果 A: 完整阅读并遵循：{advancedElicitationTask}，完成后重新显示菜单
- 如果 P: 完整阅读并遵循：{partyModeWorkflow}，完成后重新显示菜单
- 如果 C: 将内容保存到 {outputFile}，更新 frontmatter，然后完整阅读并遵循：{nextStepFile}
- 如果 任何其他评论或查询：帮助用户响应，然后 [重新显示菜单选项](#n-展示菜单选项)

#### 执行规则：
- 始终 在展示菜单后停止并等待用户输入
- 仅 当用户选择 'C' 时才进行下一步
- 在其他菜单项执行后，返回此菜单

## 追加到文档

当用户选择 'C' 时，追加到 `{outputFile}`：

```markdown
## 领域特定需求

{{discovered domain requirements}}
```

如果跳过此步骤，则不追加任何内容并继续。

## 关键步骤完成说明

仅当选择 [C 继续选项] 并且 [内容已保存或跳过] 时，你才会完整阅读并遵循：`{nextStepFile}` 以探索创新。

---

## 🚨 系统成功/失败指标

### ✅ 成功：

- 在继续之前检查了领域复杂性
- 如果复杂性低，提议跳过
- 自然对话探索领域关注点
- 识别合规性、技术和集成要求
- 记录带有缓解措施的领域特定风险
- 用户验证完整性
- 选择 C 时内容正确保存（或跳过步骤）

### ❌ 系统失败：

- 未先检查领域复杂性
- 未针对低复杂性领域提议跳过
- 遗漏关键合规性要求
- 未探索技术约束
- 未询问领域特定风险
- 内容通用而不是针对特定领域
- 在没有用户验证的情况下继续

**主规则：** 此步骤对于简单领域是可选的。对于复杂领域，专注于合规性、约束和领域模式。进行自然对话，不要遵循清单。
