---
name: 'step-v-12-completeness-validation'
description: '完整性检查 - 报告生成前的最终全面完整性检查'

# File references (ONLY variables used in this step)
nextStepFile: './step-v-13-report-complete.md'
prdFile: '{prd_file_path}'
prdFrontmatter: '{prd_frontmatter}'
validationReportPath: '{validation_report_path}'
---

# 步骤 12: 完整性验证

## 步骤目标：

最终的全面完整性检查 - 验证没有遗留模板变量，每个部分都有所需内容，特定部分的完整性，并且 frontmatter 已正确填充。

## 强制执行规则 (请先阅读):

### 通用规则：

- 🛑 绝不 在没有用户输入的情况下生成内容
- 📖 关键：在采取任何行动之前，请阅读完整的步骤文件
- 🔄 关键：当使用 'C' 加载下一步时，确保已阅读整个文件
- 📋 你是一个协调员，而不是内容生成器
- ✅ 你必须始终使用配置的 `{communication_language}` 以你的 Agent 沟通风格输出语言

### 角色强化：

- ✅ 你是验证架构师和质量保证专家
- ✅ 如果你已经被赋予了沟通或人物模式，在扮演这个新角色时继续使用它们
- ✅ 我们参与系统验证，而不是协作对话
- ✅ 你带来对细节的关注和完整性验证
- ✅ 此步骤自动运行 - 不需要用户输入

### 步骤特定规则：

- 🎯 仅关注 完整性验证
- 🚫 禁止 验证质量（在步骤 11 中已完成）或其他方面
- 💬 方法：系统检查表式验证
- 🚪 这是一个验证序列步骤 - 完成后自动继续

## 执行协议：

- 🎯 检查模板完整性（无遗留变量）
- 🎯 验证内容完整性（每个部分都有所需内容）
- 🎯 验证特定部分的完整性
- 🎯 验证 frontmatter 完整性
- 💾 将完整性矩阵追加到验证报告
- 📖 显示 "正在进行最后一步..." 并加载下一步
- 🚫 禁止 暂停或请求用户输入

## 上下文边界：

- 可用上下文：完整的 PRD 文件，frontmatter，验证报告
- 重点：仅完整性验证（最终门槛）
- 限制：不评估质量，不暂停等待用户输入
- 依赖项：步骤 1-11 已完成 - 所有验证检查已完成

## 强制序列

**关键：** 严格遵循此序列。除非用户明确要求更改，否则不要跳过、重新排序或即兴发挥。

### 1. 尝试子流程验证

**尝试使用 Task 工具生成子流程：**

"对此 PRD 执行完整性验证 - 最终门槛检查：

**1. 模板完整性：**
- 扫描 PRD 中的任何遗留模板变量
- 寻找：{variable}, {{variable}}, {placeholder}, [placeholder] 等
- 列出发现的任何带有行号的变量

**2. 内容完整性：**
- 执行摘要：有愿景陈述吗？({key content})
- 成功标准：所有标准都可测量吗？({metrics present})
- 产品范围：定义了范围内和范围外吗？({both present})
- 用户旅程：识别了用户类型吗？({users listed})
- 功能需求：FR 是否以正确格式列出？({FRs present})
- 非功能需求：带有指标的 NFR？({NFRs present})

对于每个部分：所需内容是否存在？(是/否/部分)

**3. 特定部分完整性：**
- 成功标准：每个都有具体的测量方法吗？
- 用户旅程：涵盖所有用户类型吗？
- 功能需求：涵盖 MVP 范围吗？
- 非功能需求：每个都有具体标准吗？

**4. Frontmatter 完整性：**
- stepsCompleted: 已填充？
- classification: 存在 (domain, projectType)？
- inputDocuments: 已跟踪？
- date: 存在？

返回带有每个检查状态的完整性矩阵。"

**优雅降级（如果无 Task 工具）：**
- 手动扫描模板变量
- 手动检查每个部分的所需内容
- 手动验证 frontmatter 字段
- 构建完整性矩阵

### 2. 构建完整性矩阵

**模板完整性：**
- 发现的模板变量：计数
- 如果发现，列出

**按部分划分的内容完整性：**
- 执行摘要：完整 / 不完整 / 缺失
- 成功标准：完整 / 不完整 / 缺失
- 产品范围：完整 / 不完整 / 缺失
- 用户旅程：完整 / 不完整 / 缺失
- 功能需求：完整 / 不完整 / 缺失
- 非功能需求：完整 / 不完整 / 缺失
- 其他部分：[列出完整性]

**特定部分完整性：**
- 成功标准可测量：全部 / 部分 / 无
- 旅程涵盖所有用户：是 / 部分 / 否
- FR 涵盖 MVP 范围：是 / 部分 / 否
- NFR 具有具体标准：全部 / 部分 / 无

**Frontmatter 完整性：**
- stepsCompleted: 存在 / 缺失
- classification: 存在 / 缺失
- inputDocuments: 存在 / 缺失
- date: 存在 / 缺失

**总体完整性：**
- 部分完整：X/Y
- 关键差距：[list if any]

### 3. 向验证报告报告完整性发现

追加到验证报告：

```markdown
## 完整性验证

### 模板完整性

**发现的模板变量:** {count}
{如果 count > 0, 列出带有行号的变量}
{如果 count = 0, 注意: 无遗留模板变量 ✓}

### 按部分划分的内容完整性

**执行摘要:** [完整/不完整/缺失]
{如果不完整或缺失, 注意具体差距}

**成功标准:** [完整/不完整/缺失]
{如果不完整或缺失, 注意具体差距}

**产品范围:** [完整/不完整/缺失]
{如果不完整或缺失, 注意具体差距}

**用户旅程:** [完整/不完整/缺失]
{如果不完整或缺失, 注意具体差距}

**功能需求:** [完整/不完整/缺失]
{如果不完整或缺失, 注意具体差距}

**非功能需求:** [完整/不完整/缺失]
{如果不完整或缺失, 注意具体差距}

### 特定部分完整性

**成功标准可测量性:** [全部/部分/无] 可测量
{如果部分或无, 注意哪些标准缺乏指标}

**用户旅程覆盖:** [是/部分/否] - 涵盖所有用户类型
{如果部分或否, 注意缺失的用户类型}

**FR 涵盖 MVP 范围:** [是/部分/否]
{如果部分或否, 注意范围差距}

**NFR 具有具体标准:** [全部/部分/无]
{如果部分或无, 注意哪些 NFR 缺乏具体性}

### Frontmatter 完整性

**stepsCompleted:** [存在/缺失]
**classification:** [存在/缺失]
**inputDocuments:** [存在/缺失]
**date:** [存在/缺失]

**Frontmatter 完整性:** {complete_fields}/4

### 完整性摘要

**总体完整性:** {percentage}% ({complete_sections}/{total_sections})

**关键差距:** [count] [list if any]
**次要差距:** [count] [list if any]

**严重性:** [严重 如果存在模板变量或缺少关键部分, 警告 如果次要差距, 通过 如果完整]

**推荐:**
[如果严重] "PRD 存在完整性差距，必须在使用前解决。修复模板变量并完成缺失部分。"
[如果警告] "PRD 存在次要完整性差距。解决次要差距以获得完整文档。"
[如果通过] "PRD 完整，所有所需部分和内容均存在。"
```

### 4. 显示进度并自动继续

显示："**完整性验证完成**

总体完整性：{percentage}% ({severity})

**正在进行最后一步...**"

毫不延迟，完整阅读并遵循：{nextStepFile} (step-v-13-report-complete.md)

---

## 🚨 系统成功/失败指标

### ✅ 成功：

- 系统地扫描模板变量
- 验证每个部分的所需内容
- 验证特定部分的完整性（可测量性、覆盖率、范围）
- 验证 frontmatter 完整性
- 构建包含所有检查的完整性矩阵
- 正确评估严重性
- 将发现报告给验证报告
- 自动继续进行最后一步
- 尝试子流程架构并进行优雅降级

### ❌ 系统失败：

- 未扫描模板变量
- 缺少特定部分完整性检查
- 未验证 frontmatter
- 未构建完整性矩阵
- 未将发现报告给验证报告
- 未自动继续

**主规则：** 在展示发现之前确保文档完整的最后门槛。模板变量或关键差距必须修复。
