---
name: 'step-v-06-traceability-validation'
description: '可追溯性验证 - 验证从愿景 → 成功 → 旅程 → FR 的可追溯链是否完整'

# File references (ONLY variables used in this step)
nextStepFile: './step-v-07-implementation-leakage-validation.md'
prdFile: '{prd_file_path}'
validationReportPath: '{validation_report_path}'
---

# 步骤 6: 可追溯性验证

## 步骤目标：

验证从执行摘要 → 成功标准 → 用户旅程 → 功能需求的可追溯链是否完整，确保每个需求都可以追溯到用户需求或业务目标。

## 强制执行规则 (请先阅读):

### 通用规则：

- 🛑 绝不 在没有用户输入的情况下生成内容
- 📖 关键：在采取任何行动之前，请阅读完整的步骤文件
- 🔄 关键：当使用 'C' 加载下一步时，确保已阅读整个文件
- 📋 你是一个协调员，而不是内容生成器
- ✅ 你必须始终使用配置的 `{communication_language}` 以你的 Agent 沟通风格输出语言

### 角色强化：

- ✅ 你是验证架构师和质量保证专家
- ✅ 如果你已经被赋予了沟通或人物模式，在扮演这个新角色时继续使用它们
- ✅ 我们参与系统验证，而不是协作对话
- ✅ 你带来分析严谨性和可追溯矩阵专业知识
- ✅ 此步骤自动运行 - 不需要用户输入

### 步骤特定规则：

- 🎯 仅关注 可追溯链验证
- 🚫 禁止 在此步骤中验证其他方面
- 💬 方法：系统链验证和孤儿检测
- 🚪 这是一个验证序列步骤 - 完成后自动继续

## 执行协议：

- 🎯 构建和验证可追溯矩阵
- 💾 识别断裂链和孤儿需求
- 📖 将发现追加到验证报告
- 📖 显示 "正在进行下一步检查..." 并加载下一步
- 🚫 禁止 暂停或请求用户输入

## 上下文边界：

- 可用上下文：PRD 文件，验证报告
- 重点：仅可追溯链验证
- 限制：不验证其他方面，不暂停等待用户输入
- 依赖项：步骤 2-5 已完成 - 初始验证已完成

## 强制序列

**关键：** 严格遵循此序列。除非用户明确要求更改，否则不要跳过、重新排序或即兴发挥。

### 1. 尝试子流程验证

**尝试使用 Task 工具生成子流程：**

"对此 PRD 执行可追溯性验证：

1. 从执行摘要中提取内容（愿景、目标）
2. 提取成功标准
3. 提取用户旅程（用户类型、流程、结果）
4. 提取功能需求 (FR)
5. 提取产品范围（范围内项目）

**验证链：**
- 执行摘要 → 成功标准：愿景是否与定义的成功一致？
- 成功标准 → 用户旅程：成功标准是否由用户旅程支持？
- 用户旅程 → 功能需求：每个 FR 是否追溯到用户旅程？
- 范围 → FR：MVP 范围 FR 是否与范围内项目一致？

**识别孤儿：**
- FR 无法追溯到任何用户旅程或业务目标
- 成功标准没有用户旅程支持
- 用户旅程没有支持 FR

构建可追溯矩阵并识别断裂链和孤儿 FR。

返回带有链状态和孤儿列表的结构化发现。"

### 2. 优雅降级（如果 Task 工具不可用）

如果 Task 工具不可用，直接执行分析：

**步骤 1: 提取关键元素**
- 执行摘要：记录愿景、目标、目的
- 成功标准：列出所有标准
- 用户旅程：列出用户类型及其流程
- 功能需求：列出所有 FR
- 产品范围：列出范围内项目

**步骤 2: 验证执行摘要 → 成功标准**
- 执行摘要是否提到成功维度？
- 成功标准是否与愿景一致？
- 注意任何不一致

**步骤 3: 验证成功标准 → 用户旅程**
- 对于每个成功标准，是否有实现它的用户旅程？
- 注意没有支持旅程的成功标准

**步骤 4: 验证用户旅程 → FR**
- 对于每个用户旅程/流程，是否有启用它的 FR？
- 列出没有明确用户旅程来源的 FR
- 注意孤儿 FR（没有可追溯来源的需求）

**步骤 5: 验证范围 → FR 一致性**
- MVP 范围是否与基本 FR 一致？
- 范围内项目是否有 FR 支持？
- 注意不一致

**步骤 6: 构建可追溯矩阵**
- 将每个 FR 映射到其来源（旅程或业务目标）
- 注意孤儿 FR
- 识别断裂链

### 3. 统计可追溯性问题

**断裂链：**
- 执行摘要 → 成功标准差距：计数
- 成功标准 → 用户旅程差距：计数
- 用户旅程 → FR 差距：计数
- 范围 → FR 不一致：计数

**孤儿元素：**
- 孤儿 FR（无追溯来源）：计数
- 不支持的成功标准：计数
- 没有 FR 的用户旅程：计数

**总问题：** 所有断裂链和孤儿的总和

### 4. 向验证报告报告可追溯性发现

追加到验证报告：

```markdown
## 可追溯性验证

### 链验证

**执行摘要 → 成功标准:** [完整无损/识别出差距]
{如果差距: 列出具体不一致}

**成功标准 → 用户旅程:** [完整无损/识别出差距]
{如果差距: 列出不支持的成功标准}

**用户旅程 → 功能需求:** [完整无损/识别出差距]
{如果差距: 列出没有支持 FR 的旅程}

**范围 → FR 一致性:** [完整无损/不一致]
{如果不一致: 列出具体问题}

### 孤儿元素

**孤儿功能需求:** {count}
{列出带有编号的孤儿 FR}

**不支持的成功标准:** {count}
{列出不支持的标准}

**没有 FR 的用户旅程:** {count}
{列出没有 FR 的旅程}

### 可追溯矩阵

{显示可追溯覆盖率的摘要表}

**可追溯性问题总数:** {total}

**严重性:** [严重 如果存在孤儿 FR, 警告 如果存在差距, 通过 如果完整无损]

**推荐:**
[如果严重] "存在孤儿需求 - 每个 FR 必须追溯到用户需求或业务目标。"
[如果警告] "识别出可追溯性差距 - 加强链以确保所有需求都合理。"
[如果通过] "可追溯链完整无损 - 所有需求均追溯至用户需求或业务目标。"
```

### 5. 显示进度并自动继续

显示："**可追溯性验证完成**

总问题：{count} ({severity})

**正在进行下一步验证检查...**"

毫不延迟，完整阅读并遵循：{nextStepFile} (step-v-07-implementation-leakage-validation.md)

---

## 🚨 系统成功/失败指标

### ✅ 成功：

- 系统验证所有可追溯链
- 识别带编号的孤儿 FR
- 记录断裂链
- 构建可追溯矩阵
- 正确评估严重性
- 将发现报告给验证报告
- 自动继续进行下一个验证步骤
- 尝试子流程架构并进行优雅降级

### ❌ 系统失败：

- 未验证所有可追溯链
- 缺少孤儿 FR 检测
- 未构建可追溯矩阵
- 未将发现报告给验证报告
- 未自动继续

**主规则：** 每个需求都应追溯到用户需求或业务目标。孤儿 FR 表明必须修复的可追溯性断裂。
