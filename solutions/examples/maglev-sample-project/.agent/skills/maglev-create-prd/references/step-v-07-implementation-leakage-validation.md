---
name: 'step-v-07-implementation-leakage-validation'
description: '实施泄漏检查 - 确保 FR 和 NFR 不包含实现细节'

# File references (ONLY variables used in this step)
nextStepFile: './step-v-08-domain-compliance-validation.md'
prdFile: '{prd_file_path}'
validationReportPath: '{validation_report_path}'
---

# 步骤 7: 实施泄漏验证

## 步骤目标：

确保功能需求和非功能需求不包含实现细节 - 它们应该指定“什么”，而不是“如何”。

## 强制执行规则 (请先阅读):

### 通用规则：

- 🛑 绝不 在没有用户输入的情况下生成内容
- 📖 关键：在采取任何行动之前，请阅读完整的步骤文件
- 🔄 关键：当使用 'C' 加载下一步时，确保已阅读整个文件
- 📋 你是一个协调员，而不是内容生成器
- ✅ 你必须始终使用配置的 `{communication_language}` 以你的 Agent 沟通风格输出语言

### 角色强化：

- ✅ 你是验证架构师和质量保证专家
- ✅ 如果你已经被赋予了沟通或人物模式，在扮演这个新角色时继续使用它们
- ✅ 我们参与系统验证，而不是协作对话
- ✅ 你带来分析严谨性和关注点分离专业知识
- ✅ 此步骤自动运行 - 不需要用户输入

### 步骤特定规则：

- 🎯 仅关注 实施泄漏检测
- 🚫 禁止 在此步骤中验证其他方面
- 💬 方法：技术和实施术语的系统扫描
- 🚪 这是一个验证序列步骤 - 完成后自动继续

## 执行协议：

- 🎯 扫描 FR 和 NFR 中的实施术语
- 💾 区分能力相关与泄漏
- 📖 将发现追加到验证报告
- 📖 显示 "正在进行下一步检查..." 并加载下一步
- 🚫 禁止 暂停或请求用户输入

## 上下文边界：

- 可用上下文：PRD 文件，验证报告
- 重点：仅实施泄漏检测
- 限制：不验证其他方面，不暂停等待用户输入
- 依赖项：步骤 2-6 已完成 - 初始验证已完成

## 强制序列

**关键：** 严格遵循此序列。除非用户明确要求更改，否则不要跳过、重新排序或即兴发挥。

### 1. 尝试子流程验证

**尝试使用 Task 工具生成子流程：**

"对此 PRD 执行实施泄漏验证：

**扫描：**
1. 技术名称 (React, Vue, Angular, PostgreSQL, MongoDB, AWS, GCP, Azure, Docker, Kubernetes 等)
2. 库名称 (Redux, axios, lodash, Express, Django, Rails, Spring 等)
3. 数据结构 (JSON, XML, CSV) 除非与能力相关
4. 架构模式 (MVC, 微服务, serverless) 除非是业务需求
5. 协议名称 (HTTP, REST, GraphQL, WebSockets) - 检查是否与能力相关

**对于发现的每个术语：**
- 这是否与能力相关？（例如，'API 消费者可以访问...' - API 是能力）
- 或者这是实现细节？（例如，'用于...的 React 组件' - 实现）

记录违规及行号和解释。

返回带有泄漏计数和示例的结构化发现。"

### 2. 优雅降级（如果 Task 工具不可用）

如果 Task 工具不可用，直接执行分析：

**要扫描的实施泄漏术语：**

**前端框架:**
React, Vue, Angular, Svelte, Solid, Next.js, Nuxt 等

**后端框架:**
Express, Django, Rails, Spring, Laravel, FastAPI 等

**数据库:**
PostgreSQL, MySQL, MongoDB, Redis, DynamoDB, Cassandra 等

**云平台:**
AWS, GCP, Azure, Cloudflare, Vercel, Netlify 等

**基础设施:**
Docker, Kubernetes, Terraform, Ansible 等

**库:**
Redux, Zustand, axios, fetch, lodash, jQuery 等

**数据格式:**
JSON, XML, YAML, CSV (除非与能力相关)

**对于 FR/NFR 中发现的每个术语：**
- 确定它是能力相关还是实施泄漏
- 示例："API 消费者可以通过 REST 端点访问数据" - API/REST 是能力
- 示例："React 组件使用 Redux 获取数据" - 实施泄漏

**统计违规并注意行号**

### 3. 统计实施泄漏

**按类别：**
- 前端框架泄漏：计数
- 后端框架泄漏：计数
- 数据库泄漏：计数
- 云平台泄漏：计数
- 基础设施泄漏：计数
- 库泄漏：计数
- 其他实施细节：计数

**总实施泄漏违规：** 总和

### 4. 向验证报告报告实施泄漏发现

追加到验证报告：

```markdown
## 实施泄漏验证

### 按类别泄漏

**前端框架:** {count} 违规
{如果违规, 列出带有行号的示例}

**后端框架:** {count} 违规
{如果违规, 列出带有行号的示例}

**数据库:** {count} 违规
{如果违规, 列出带有行号的示例}

**云平台:** {count} 违规
{如果违规, 列出带有行号的示例}

**基础设施:** {count} 违规
{如果违规, 列出带有行号的示例}

**库:** {count} 违规
{如果违规, 列出带有行号的示例}

**其他实施细节:** {count} 违规
{如果违规, 列出带有行号的示例}

### 摘要

**总实施泄漏违规:** {total}

**严重性:** [严重 如果 >5 违规, 警告 如果 2-5, 通过 如果 <2]

**推荐:**
[如果严重] "发现大量实施泄漏。需求指定了“如何”而不是“什么”。删除所有实施细节 - 这些属于架构，而不属于 PRD。"
[如果警告] "检测到一些实施泄漏。审查违规并从需求中删除实施细节。"
[如果通过] "未发现重大实施泄漏。需求正确指定了“什么”而不是“如何”。"

**注意:** API 消费者、GraphQL（如果需要）和其他能力相关术语是可以接受的，当它们描述系统必须做什么，而不是如何构建它时。
```

### 5. 显示进度并自动继续

显示："**实施泄漏验证完成**

总违规：{count} ({severity})

**正在进行下一步验证检查...**"

毫不延迟，完整阅读并遵循：{nextStepFile} (step-v-08-domain-compliance-validation.md)

---

## 🚨 系统成功/失败指标

### ✅ 成功：

- 扫描 FR 和 NFR 中的所有实施术语类别
- 区分能力相关与实施泄漏
- 带有行号和解释记录违规
- 正确评估严重性
- 将发现报告给验证报告
- 自动继续进行下一个验证步骤
- 尝试子流程架构并进行优雅降级

### ❌ 系统失败：

- 未扫描所有实施术语类别
- 未区分能力相关与泄漏
- 违规缺少行号
- 未将发现报告给验证报告
- 未自动继续

**主规则：** 需求指定“什么”，而不是“如何”。实施细节属于架构文档，不属于 PRD。
