---
name: 'step-e-01b-legacy-conversion'
description: '遗留 PRD 转换评估 - 分析遗留 PRD 并提议转换策略'

# File references (ONLY variables used in this step)
nextStepFile: './step-e-02-review.md'
prdFile: '{prd_file_path}'
prdPurpose: 'references/prd-purpose.md'
---

# 步骤 E-1B: 遗留 PRD 转换评估

## 步骤目标：

根据 BMAD 标准分析遗留 PRD，识别差距，提议转换策略，并让用户选择如何继续。

## 强制执行规则 (请先阅读):

### 通用规则：

- 🛑 绝不 在没有用户输入的情况下生成内容
- 📖 关键：在采取任何行动之前，请阅读完整的步骤文件
- 🔄 关键：当使用 'C' 加载下一步时，确保已阅读整个文件
- 📋 你是一个协调员，而不是内容生成器
- ✅ 你必须始终使用配置的 `{communication_language}` 以你的 Agent 沟通风格输出语言

### 角色强化：

- ✅ 你是验证架构师和 PRD 改进专家
- ✅ 如果你已经被赋予了沟通或人物模式，在扮演这个新角色时继续使用它们
- ✅ 我们参与协作对话，而不是命令-响应
- ✅ 你带来 BMAD 标准专业知识和转换指导
- ✅ 用户带来领域专业知识和编辑要求

### 步骤特定规则：

- 🎯 仅关注 转换评估和建议
- 🚫 禁止 尚未进行转换（那是在编辑步骤中）
- 💬 方法：带有明确建议的分析差距分析
- 🚪 这是一个分支步骤 - 用户选择转换路径

## 执行协议：

- 🎯 根据 BMAD 标准分析遗留 PRD
- 💾 识别差距并估算转换工作量
- 📖 展示带有工作量估算的转换选项
- 🚫 禁止 在没有用户选择的情况下继续

## 上下文边界：

- 可用上下文：遗留 PRD，用户的编辑要求，prd-purpose 标准
- 重点：仅转换评估（不是实际转换）
- 限制：还没有转换，还没有验证
- 依赖项：步骤 e-01 检测到遗留格式并路由至此

## 强制序列

**关键：** 严格遵循此序列。除非用户明确要求更改，否则不要跳过、重新排序或即兴发挥。

### 1. 尝试子流程评估

**尝试使用带有子代理的 Task 工具：**

"执行遗留 PRD 转换评估：

**加载 PRD 和 prd-purpose.md**

**对于每个 BMAD PRD 部分，分析：**
1. PRD 是否有此部分？（执行摘要、成功标准、产品范围、用户旅程、功能需求、非功能需求）
2. 如果存在：它是否完整且结构良好？
3. 如果缺少：是否存在可以迁移到此部分的内容？
4. 创建/完成的工作量：极小 / 中等 / 显著

**识别：**
- 核心部分存在：{count}/6
- 每个部分的内容差距
- 总体转换工作量：快速 / 中等 / 大量
- 推荐方法：完全重组 vs 有针对性的改进

返回带有差距分析和工作量估算的转换评估。"

**优雅降级（如果没有 Task 工具）：**
- 手动检查 PRD 的每个 BMAD 部分
- 注意存在什么和缺失什么
- 估算转换工作量
- 识别最佳转换方法

### 2. 构建差距分析

**对于每个 BMAD 核心部分：**

**执行摘要：**
- 存在：[是/否/部分]
- 差距：[缺失或不完整的内容]
- 完成工作量：[极小/中等/显著]

**成功标准：**
- 存在：[是/否/部分]
- 差距：[缺失或不完整的内容]
- 完成工作量：[极小/中等/显著]

**产品范围：**
- 存在：[是/否/部分]
- 差距：[缺失或不完整的内容]
- 完成工作量：[极小/中等/显著]

**用户旅程：**
- 存在：[是/否/部分]
- 差距：[缺失或不完整的内容]
- 完成工作量：[极小/中等/显著]

**功能需求：**
- 存在：[是/否/部分]
- 差距：[缺失或不完整的内容]
- 完成工作量：[极小/中等/显著]

**非功能需求：**
- 存在：[是/否/部分]
- 差距：[缺失或不完整的内容]
- 完成工作量：[极小/中等/显著]

**总体评估：**
- 存在部分：{count}/6
- 总转换工作量：[快速/中等/大量]
- 推荐：[完全重组 / 有针对性的改进]

### 3. 展示转换评估

显示：

"**遗留 PRD 转换评估**

**当前 PRD 结构：**
- 核心部分存在：{count}/6
{List which sections are present/missing}

**差距分析：**

{Present gap analysis table showing each section's status and effort}

**总体转换工作量：** {effort level}

**你的编辑目标：**
{Reiterate user's stated edit requirements}

**推荐：**
{Based on effort and user goals, recommend best approach}

**你想如何继续？**"

### 4. 展示菜单选项

**[R] 重组为 BMAD** - 完全转换为 BMAD 格式，然后应用你的编辑
**[I] 有针对性的改进** - 在不重组的情况下对现有结构应用你的编辑
**[E] 编辑与重组** - 两者都做：转换格式并应用你的编辑
**[X] 退出** - 审查评估并决定

#### 执行规则：

- 始终 停止并等待用户输入
- 仅根据用户选择继续

#### 菜单处理逻辑：

- 如果 R (重组): 记录转换模式，然后加载下一步
- 如果 I (有针对性): 记录有针对性模式，然后加载下一步
- 如果 E (编辑与重组): 记录两种模式，然后加载下一步
- 如果 X (退出): 显示摘要，退出

### 5. 记录转换策略

存储转换决策以便下一步使用：

- **转换模式：** [完全重组 / 有针对性的改进 / 两者]
- **编辑要求：** [来自步骤 e-01 的用户要求]
- **差距分析：** [识别出的差距摘要]

显示： "**转换策略已记录**

模式：{conversion mode}
编辑目标：{summary}

**正在进行深度审查...**"

完整阅读并遵循：{nextStepFile} (step-e-02-review.md)

---

## 🚨 系统成功/失败指标

### ✅ 成功：

- 分析所有 6 个 BMAD 核心部分以查找差距
- 为每个部分提供工作量估算
- 正确评估总体转换工作量
- 根据工作量和用户目标提供明确建议
- 用户选择转换策略（重组/有针对性/两者）
- 记录转换策略以便下一步使用

### ❌ 系统失败：

- 未分析所有 6 个核心部分
- 缺少工作量估算
- 未提供明确建议
- 未经用户选择自动继续
- 未记录转换策略

**主规则：** 遗留 PRD 需要转换评估，以便用户了解所涉及的工作并可以选择最佳方法。
