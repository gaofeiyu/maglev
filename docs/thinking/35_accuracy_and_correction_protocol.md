# Maglev 纠错与防伪协议 (说人话版)

> **Created**: 2026-02-09
> **Status**: Draft
> **Intent**: 用最直白的话，讲清楚怎么保证 AI 写的代码是对的。

---

## TL;DR (太长不看版)

1.  **别手改代码**：把 AI 当编译器。发现 Bug，去改“源代码”（Spec文档），然后让 AI 重新生成代码。
2.  **各司其职**：
    *   **PA (产品)**：验货。问：“这是用户要的吗？”
    *   **TL (技术)**：验方子。问：“逻辑通不通？安不安全？”
    *   **AI (苦力)**：干活。它只负责：“方子咋写我咋做。”

---

## 1. 核心原则：修方子，不修菜

想象我们在开餐厅：
*   **Spec (需求文档)** = **菜谱**
*   **Code (代码)** = **这盘菜**
*   **AI** = **厨师**

如果顾客（用户）觉得菜太咸了：
*   ❌ **传统做法**：厨师赶紧端回厨房，往菜里兑点水。（Patch Code）-> 结果：下次做还是咸。
*   ✅ **Maglev 做法**：把菜谱上的“盐 5g”改成“盐 3g”，然后**倒掉这盘菜，按新菜谱重做**。（Update Spec -> Re-compile）

**铁律**：除非火烧眉毛（Hotfix），否则严禁直接改代码。

---

## 2. 角色分工：谁背什么锅？

出了问题，先看是谁的锅，再决定怎么修。

| 角色 | 身份 | 负责问题 | 典型台词 | 怎么修？ |
| :--- | :--- | :--- | :--- | :--- |
| **Product Architect (PA)** | 大厨/顾客 | **意图错** (Intent Idea) | *"我要的是红烧肉，你给我是回锅肉？"* | **改需求 (PRD)** |
| **Tech Lead (TL)** | 食品安检 | **逻辑错** (Logic / Safety) | *"这肉没熟，吃了会拉肚子。"* | **改设计 (Tech Spec)** |
| **AI Agent** (Builder) | 切墩小工 | **执行错** (Implementation) | *"手抖了，盐放多了。"* | **重写 (Regenerate)** |

---

## 3. 怎么干？(流程图)

### 第一步：还没开工 (Design Phase)
*   **PA** 说想法，**AI** 写成文档。
*   **TL** 检查文档（Audit）：
    *   *"这里逻辑不通" -> 打回去改文档。*
    *   *"这里有歧义" -> 打回去改文档。*
*   **直到文档没毛病了，才允许 AI 写代码。**

### 第二步：写代码中 (Coding Phase)
*   **AI** 先写个测试（试金石）。
*   **AI** 再写代码。
*   如果测试不过？AI 自己修，不用烦你。

### 第三步：验收环节 (Verification)
*   你发现 Bug 了。
    1.  **定性**：是 AI 抽风了（偶发），还是文档本来就写错了（根源）？
    2.  **动手**：去改对应的 Markdown 文档。
    3.  **重来**：让 AI 重新生成这个文件。

---

## 4. 怎么信得过 AI？

*   **双重检查**：Maglev 会用另一个 AI (Reviewer) 去查写代码那个 AI (Builder) 的作业。
*   **眼见为实**：如果是改界面，别光看代码，要看截图或录屏。
*   **你得签字**：关键节点（比如上线前），必须得有人类说 "Approve"。

---

## 5. 总结

Maglev 的逻辑很简单：**把文档当成源代码写，把代码当成汇编语言用。**
你只要保证文档是对的，代码就是对的。
